dsl_version: 0.8.0
service:
  name: elasticsearch
  headless: true
  ports:
    - {{ elasticsearch.port }}
    - {{ elasticsearch.cluster_port }}
  containers:
    - name: elasticsearch-data
      image: elasticsearch
      volumes:
        - name: elasticsearch-data
          path: /usr/share/elasticsearch/data
          type: empty-dir
          readOnly: false
      env:
        - name: SERVICE
          value: elasticsearch
        - name: KUBERNETES_NAMESPACE
          value: {{ elasticsearch.namespace }}
        - name: NODE_DATA
          value: "true"
        - name: NODE_MASTER
          value: "false"
      daemon:
        files:
          - elasticsearch.yml
        command: /usr/share/elasticsearch/bin/elasticsearch
    - name: elasticsearch-master
      image: elasticsearch
      env:
        - name: SERVICE
          value: elasticsearch
        - name: KUBERNETES_NAMESPACE
          value: {{ elasticsearch.namespace }}
        - name: NODE_DATA
          value: "false"
        - name: NODE_MASTER
          value: "true"
      daemon:
        files:
          - elasticsearch.yml
        command: /usr/share/elasticsearch/bin/elasticsearch
    - name: elasticsearch-client
      image: elasticsearch
      env:
        - name: SERVICE
          value: elasticsearch
        - name: KUBERNETES_NAMESPACE
          value: {{ elasticsearch.namespace }}
        - name: NODE_DATA
          value: "false"
        - name: NODE_MASTER
          value: "false"
      daemon:
        files:
          - elasticsearch.yml
        command: /usr/share/elasticsearch/bin/elasticsearch
#    - name: cron
#      image: cron
#      daemon:
#        command: cron -f
#        files:
#          - es-curator-config
#          - es-curator-action-delete-indice
#          - es-curator-cronjob

files:
  elasticsearch.yml:
    path: /usr/share/elasticsearch/config/elasticsearch.yml
    content: elasticsearch.yml.j2
  es-curator-config:
    path: /etc/curator/curator.yaml
    content: curator.yaml.j2
  es-curator-action-delete-indice:
    path: /etc/curator/action-delete-indice.yaml
    content: curator-action-delete-indice.yaml.j2
  es-curator-cronjob:
    path: /etc/cron.d/curator
    content: curator-cronjob
    perm: "0644"
